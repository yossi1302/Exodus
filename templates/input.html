{% extends "base.html" %}

{% block title %}Generate Schedule - FSP Schedule Generator{% endblock %}

{% block content %}
<div class="upload-section">
    <h2>Generate Schedule</h2>
    <p>Click the button below to generate a schedule using the course data, lecturer availability, and program information.</p>
    <p><strong>Schedule for:</strong> Week of October 27, 2025</p>
    
    <div class="upload-form">
        <form id="uploadForm">
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Generate Schedule Now</button>
            </div>
        </form>
        
        <div id="statusMessage" class="status-message"></div>
        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Generating schedule with PuLP optimizer... This may take a few seconds.</p>
        </div>
    </div>
    
    <div class="info-section">
        <h3>Data Sources</h3>
        <ul>
            <li><strong>Courses:</strong> static/json_inputs_period/courses.json</li>
            <li><strong>Lecturers:</strong> static/json_inputs_period/lecturers.json</li>
            <li><strong>Programs:</strong> static/json_inputs_period/programs.json</li>
            <li><strong>Classrooms:</strong> static/json_inputs_static/classrooms.json</li>
        </ul>
        
        <h3>Constraints Applied</h3>
        <ol>
            <li>Teacher can only teach one course at the same time</li>
            <li>Required class hours met by end of week</li>
            <li>No scheduling at unavailable teacher times</li>
            <li>At least 50% of students fit in room</li>
            <li>4 lecture slots per day (08:30, 11:00, 13:30, 16:00)</li>
            <li>5 weekdays for lectures (Monday-Friday)</li>
            <li>Student group has max 1 lecture at a time</li>
            <li>Lectures before tutorials (Mon-Wed vs Thu-Fri)</li>
            <li>No room conflicts</li>
            <li>Each session scheduled exactly once</li>
        </ol>
    </div>
</div>
      "tutorials": 1,
      "labs": 2,
      "hours_per_session": 2,
      "theory_before_practical": true
    }
  ],
  "teachers": {
    "Teacher Name": {
      "courses": ["BCS1220"],
      "unavailable": ["Monday-08:30"]
    }
  },
  "programs": {
    "CS_Y1": {
      "size": 300,
      "courses": ["BCS1220", "BCS1440"]
    }
  }
}</pre>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const statusMessage = document.getElementById('statusMessage');
    const loadingIndicator = document.getElementById('loadingIndicator');
    
    // Show loading
    loadingIndicator.style.display = 'block';
    statusMessage.textContent = '';
    
    try {
        const response = await fetch('/input', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        const result = await response.json();
        
        loadingIndicator.style.display = 'none';
        
        if (response.ok && result.success) {
            statusMessage.className = 'status-message success';
            statusMessage.textContent = result.message;
            
            // Redirect to schedule view after 1 second
            setTimeout(() => {
                window.location.href = `/schedule/${result.schedule_id}`;
            }, 1000);
        } else {
            statusMessage.className = 'status-message error';
            statusMessage.textContent = 'Error: ' + result.error;
        }
    } catch (error) {
        loadingIndicator.style.display = 'none';
        statusMessage.className = 'status-message error';
        statusMessage.textContent = 'Error: ' + error.message;
    }
});
</script>
{% endblock %}
